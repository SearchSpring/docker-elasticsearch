consul:
  image: progrium/consul
  ports:
    - "8300:8300"
    - "8301:8301/udp"
    - "8302:8302/udp"
    - "8500:8500"
    - "53:53/udp"
    - "172.17.42.1:53:53/udp"
  dns: 8.8.8.8
  command: -bootstrap-expect 1 -advertise 172.17.42.1 -server -ui-dir /ui
  net: "bridge"

elasticsearch:
  build: .
  ports:
    - "9200:9200"
    - "9300:9300"
  expose:
    - "9200"
    - "9300"
  dns:
    - 172.17.42.1
    - 8.8.8.8

  environment:
    - SERVICE_9200_NAME=elasticsearch
    - SERVICE_9300_NAME=elasticsearch_trans
    - CLUSTERNAME=elasticsearch-cluster
    - DATA=/data
    - PORT=9200
    - EXPECTED_NODES=1
    - SERVICE_TAG=elasticsearch
  net: "bridge"

registrator:
  image: progrium/registrator:latest
  dns:
    - 172.17.42.1
    - 8.8.8.8
  entrypoint:
    - "registrator"
    - "consul://consul.service.consul:8500"
  volumes:
    - /var/run/docker.sock:/tmp/docker.sock
  net: "bridge"
